<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Dashboard Administrador | Clinik Dent</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<link href="css/bootstrap.min.css" rel="stylesheet"/>
<link href="css/font-awesome.min.css" rel="stylesheet"/>
<link href="css/templatemo-style.css" rel="stylesheet"/>
<style>
        body { background: #f7f9fb; }
        .dashboard-box { background: #fff; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); padding: 30px; margin-top: 40px; }
        .dashboard-header { margin-bottom: 30px; }
    </style>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&amp;display=swap" rel="stylesheet"/><style>
        .modal-content {
            background-color: #f9f9f9 !important;
        }
        .tab-pane, .form-control, .modal-content, label {
            color: #212529 !important;
        }
        .modal {
            z-index: 1055 !important;
        }
        </style></head>
<body>
<nav class="navbar navbar-default">
<div class="container-fluid">
<div class="navbar-header">
<a class="navbar-brand" href="#">Clinik Dent</a>
</div>
<ul class="nav navbar-nav navbar-right">
<li><a href="index.html"><i class="fa fa-sign-out"></i> Cerrar sesión</a></li>
</ul>
</div>
</nav>
<div class="container">
<div class="dashboard-box">
<div class="dashboard-header">
<h2 id="nombre-admin">Bienvenido, Administrador</h2>
<span id="doc-admin" style="color:#3f51b5;font-size:1.1em;"></span>
<p>Panel de control para la gestión integral de la clínica.</p>
</div>
</div></div><script crossorigin="anonymous" integrity="sha384-VF7QtFThmNP2U3RPZtfrTtDkzRvZzSg1blUnGCHwEZKZ0QkPZjQUkRzkhgZsz5Dn" src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script><div class="modal-backdrop fade show"></div></body>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
const firebaseConfig = {
  apiKey: "AIzaSyDZDyoYOm-P8KJCs-Jukt_eaOiYKIrAoj4",
  authDomain: "clinikdent-f39c3.firebaseapp.com",
  projectId: "clinikdent-f39c3",
  storageBucket: "clinikdent-f39c3.firebasestorage.app",
  messagingSenderId: "543210066190",
  appId: "1:543210066190:web:0cba6a0ada95da1a4e875f",
  measurementId: "G-Q9CXVCY7VR"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
onAuthStateChanged(auth, async user => {
  if (user) {
    // Buscar admin por email
    const q = query(collection(db, 'administradores'), where('email', '==', user.email));
    const snapshot = await getDocs(q);
    if (!snapshot.empty) {
      const data = snapshot.docs[0].data();
      document.getElementById('nombre-admin').textContent = `Bienvenido, ${data.nombre || ''} ${data.apellidos || ''}`.trim() || user.email;
      document.getElementById('doc-admin').textContent = data.numeroDocumento ? `CC: ${data.numeroDocumento}` : '';
    } else {
      document.getElementById('nombre-admin').textContent = `Bienvenido, ${user.email}`;
    }
  }
});
</script>
<div class="row">
<div class="col-md-4 col-sm-6">
<div class="panel panel-warning">
<div class="panel-heading"><i class="fa fa-users"></i> Usuarios</div>
<div class="panel-body">
<p>Gestiona pacientes, odontólogos y personal administrativo.</p>
<a class="btn btn-primary btn-block" href="admin-usuarios.html">Ver usuarios</a>
</div>
</div>
</div>
<div class="col-md-4 col-sm-6">
<div class="panel panel-warning">
<div class="panel-heading"><i class="fa fa-calendar"></i> Citas</div>
<div class="panel-body">
<p>Administra todas las citas de la clínica.</p>
<a class="btn btn-primary btn-block" href="admin-citas.html">Ver citas</a>
</div>
</div>
</div>
<div class="col-md-4 col-sm-6">
<div class="panel panel-warning">
<div class="panel-heading"><i class="fa fa-bar-chart"></i> Reportes</div>
<div class="panel-body">
<p>Visualiza reportes de gestión y estadísticas.</p>
<a class="btn btn-primary btn-block" href="admin-reportes.html">Ver reportes</a>
</div>
</div>
</div>
</div>
<script src="js/jquery.js"></script>
<script src="js/bootstrap.min.js"></script>
<script type="module">
    // Secure logout: clear session, sign out, and prevent back navigation
    document.addEventListener('DOMContentLoaded', function() {
        const logoutLink = document.querySelector('a[href="index.html"]');
        if (logoutLink) {
            logoutLink.addEventListener('click', async function(e) {
                e.preventDefault();
                try {
                    const { getAuth, signOut } = await import('https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js');
                    const auth = getAuth();
                    await signOut(auth);
                } catch (e) {}
                // Clear sessionStorage and localStorage
                sessionStorage.clear();
                localStorage.clear();
                // Replace history so back button doesn't return to dashboard
                window.location.replace('index.html');
                // Try to prevent back navigation
                window.history.pushState(null, '', window.location.href);
                window.onpopstate = function() {
                    window.location.replace('index.html');
                };
            });
        }
    });
    </script>
</html>
